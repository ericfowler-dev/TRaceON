BMSAnalyzer correction plan (integration notes)

1) File reading and workbook parsing
- Use FileReader.readAsArrayBuffer(file) instead of readAsBinaryString.
- Parse with XLSX.read(arrayBuffer, { type: "array", cellDates: true }) so date cells can become Date objects.
- Keep XLSX.utils.sheet_to_json(..., { defval: null, raw: true }) to preserve numbers as numbers.

2) Replace getVal and parseDate
- Build a header index once per sheet using normalized headers.
- Use strict lookup for Time and other critical columns.
- For Time values accept Date objects, strings, and Excel serial numbers.

3) Preserve numeric zeros
- Replace parseFloat(x) || undefined patterns.
- Use a helper that returns undefined only when the value is not a finite number.

4) Merge sheets by time bucket
- Create a time key by rounding timestamps to a bucket, for example 1000 ms.
- Use that key to merge voltage, temp, peak, and system rows into the same entry even when exported at slightly different times.

5) Fault event severity transitions
Choose one approach
A) Segment events
- If severity changes while active, close the current event at that timestamp and open a new event with the new severity.
B) Single event with transitions
- Keep one event open and update severity, storing a transitions array with { time, from, to }.

6) Snapshot lookup performance
- Precompute an array of timestamps from the final timeSeries.
- Use binary search to find the nearest snapshot for a fault timestamp.

7) Heat map and empty data guards
- If there are no valid voltages at a snapshot, render a neutral label like NO DATA.
- If max equals min, treat as FLAT rather than dividing by zero.

8) Tailwind dynamic classes
- Replace template string classes like text-${highlight}-400 with a literal mapping table so Tailwind can detect them.
- Alternatively, add a safelist in Tailwind config for the finite set of highlight colors.

9) Recharts Y axis domain strings
- Use the documented string format with spaces, for example "dataMin - 30".
- Or provide a domain function.

Files
- bms_parser_proposal.js includes reference utilities and a reference parse flow for timeSeries and faults.
